FROM admin@manjaro/manjaro-gnome-22.1.3-x86_64

WORKDIR /home/vedv/ydf

# update the system
RUN sudo pacman-mirrors --country United_States && \
  sudo pacman -Syyu --noconfirm --needed

# install gnome base system
RUN sudo -H flatpak install --assumeyes --noninteractive io.github.andreibachim.shortcut

# install dev dependencies
COPY packages.env .

RUN mkdir tools
COPY tools/install-dev-manjaro.vedv tools
RUN tools/install-dev-manjaro.vedv

# install runtime dependencies
## yay
RUN sudo pacman -S --noconfirm --needed yay && \
  source ./packages.env && \
  yay -S --noconfirm --needed "\${PKG_RUN_MANJARO_YAY[@]}"
## snapd
RUN sudo pacman -S --noconfirm --needed snapd && \
  sudo systemctl enable apparmor && \
  sudo systemctl enable snapd.apparmor && \
  sudo systemctl enable snapd && \
  sudo ln -vs /var/lib/snapd/snap /snap
## docker
RUN sudo pacman -S --noconfirm --needed docker docker-compose && \
  sudo systemctl enable docker && \
  sudo usermod -aG docker "\$USER"
## YZSH
RUN cd "\$(mktemp -d)" && \
  git clone https://github.com/yunielrc/yzsh.git && cd yzsh && \
  make install
